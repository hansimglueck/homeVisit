/**
 * Created by jeanbluer on 26.01.15.
 */

function game() {
    this.play = false;
    this.deckId = 0;
    this.stepId = 0;
    this.decks;

}

game.prototype = {
    start: function() {
        if (this.play == false) {
            var g = this;
            var Deck = require('../models/Deck.js');
            Deck.find(function (err, decks) {
                if (err) return next(err);
                g.decks=decks;
                console.log(g.decks);
                g.step();
            });
            this.play = true;

            return {msg:"started game"};
        } else {
            return {msg:"already playing"};
        }
    },

    stop: function() {
        this.play = false;
        this.stepId = 0;
        return {msg:'game stopped'};
    },

    step: function(id) {
        var msg = "";
        if (this.play == false) {
            return {msg: 'not playing!'};
        };
        if (id) {
            this.stepId = id;
        } else {
            this.stepId += 1;
        }
        if (this.stepId >= this.decks[this.deckId].items.length) {
            this.stepId = 0;
            msg += "no more items - ";
        }
        var content = {
            type: this.decks[this.deckId].items[this.stepId].type,
            text: this.decks[this.deckId].items[this.stepId].text
        }
        msg += "stepped to "+this.stepId;
        return {content: content, msg: msg};
    }

}


module.exports = new game();